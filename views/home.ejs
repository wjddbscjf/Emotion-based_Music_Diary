<section class="panel home">
  <header class="hero">
    <div class="hero-text">
      <h1>Emotion-based Music Diary</h1>
      <p class="lead">
        일기를 분석해 분위기에 맞는 음악을 추천합니다.
        YouTube 좋아요를 동기화해 개별 유튜브 노래 추천도 받을 수 있습니다.
      </p>

      <div class="hero-actions">
        <a class="btn" href="/diary">일기 작성·분석 (로그인 불필요)</a>
        <% if (!session?.userId) { %>
          <a class="btn outline" href="/auth/google">Google 로그인 (YouTube)</a>
        <% } %>
      </div>

      <p class="hint">YouTube 기능(좋아요 동기화/추천)은 Google 로그인 후 사용 가능합니다.</p>

    </div>

    <aside class="hero-side">
      <div class="account-card">
        <div class="account-head">
          <div class="avatar">
            <% if (session?.user?.picture) { %>
              <img src="<%= session.user.picture %>" alt="profile" />
            <% } else { %>
              <span>YT</span>
            <% } %>
          </div>

          <div class="account-meta">
            <% if (session?.userId) { %>
              <div class="account-title">YouTube 연결됨</div>
              <div class="account-sub"><%= session?.user?.name || "User" %></div>
            <% } else { %>
              <div class="account-title">YouTube 미연결</div>
              <div class="account-sub">Google 로그인 후 사용 가능</div>
            <% } %>
          </div>
        </div>

        <div class="account-actions">
          <% if (session?.userId) { %>
            <a class="btn outline" href="/logout">로그아웃</a>
            <a class="btn" id="sync-btn" href="/youtube/sync">좋아요 동기화</a>
            <a class="btn outline" href="/youtube/recommend">유튜브 노래 추천</a>
          <% } else { %>
            <a class="btn" href="/auth/google">Google 로그인</a>
            <a class="btn outline disabled" aria-disabled="true" href="#" onclick="return false;">좋아요 동기화</a>
            <a class="btn outline disabled" aria-disabled="true" href="#" onclick="return false;">유튜브 노래 추천</a>
          <% } %>
        </div>
      </div>
    </aside>
  </header>

  <div class="home-grid">
    <article class="home-card">
      <div class="badge">Diary</div>
      <h2>일기 기반 Spotify 추천</h2>
      <p class="muted">로그인 없이 바로 사용 가능합니다. 일기를 분석해 트랙을 추천합니다.</p>
      <div class="card-actions">
        <a class="btn" href="/diary">시작하기</a>
      </div>
    </article>

    <article class="home-card">
      <div class="badge yt">YouTube</div>
      <h2>YouTube 좋아요 기반 추천</h2>
      <p class="muted">좋아요 동기화 후, 토큰화·랭킹으로 후보를 정렬합니다. (5분 소요)</p>
      <div class="card-actions">
        <% if (session?.userId) { %>
          <a class="btn" href="/youtube/sync">좋아요 동기화</a>
          <a class="btn outline" href="/youtube/recommend">추천 보기</a>
        <% } else { %>
          <a class="btn" href="/auth/google">Google 로그인</a>
          <a class="btn outline disabled" aria-disabled="true" href="#" onclick="return false;">추천 보기</a>
        <% } %>
      </div>
    </article>
    <p class="muted" style="grid-column: 1 / -1; margin: 8px 0 0; font-size: 0.92rem;">
      안내: 좋아요에 “음악(카테고리)”으로 분류된 영상이 없으면 추천이 제대로 작동되지 않을 수 있습니다. 동기화 시 제목/채널 등 일부 메타데이터가 DB에 저장될 수 있습니다.
      또한 YouTube API 할당량 제한으로 사용자가 많으면 일시적으로 기능이 제한될 수 있습니다.
    </p>
  </div>
</section>

<script>
  (function () {
    var btn = document.getElementById("sync-btn");
    if (!btn) return;
    btn.addEventListener("click", function () {
      btn.classList.add("busy");
      btn.textContent = "동기화 진행 중...";
    });
  })();
</script>
